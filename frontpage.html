<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
</head>
<body>
    <div class="container">
        <div class="row">
            <h1 id="user">Items for you</h1>
            <div class="col-md-12">
                <div class="row" id='frontpage_products'>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/gh/recombee/js-api-client@2.2.0/dist/recombee-api-client.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-130592384-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-130592384-1');
    </script>
    <script type="text/javascript">

    // A simple function for rendering a box with recommended product
    function showProduct(r){
        vals = r.values
        return  [
          '<div class="col-md-4 text-center col-sm-6 col-xs-6">',
          '    <div class="thumbnail product-box" style="min-height:300px">',
          '        <img src="' + vals['image'] +'" alt="" />',
          '        <div class="caption">',
          '            <h3><a href="' + vals['link'] +'">' + vals['title'] + '</a></h3>',
          '            <p>Tag : <strong> ' + vals['tag'] + '</strong>  </p>',
          '            <p>Date : <strong> ' + vals['date'] + '</strong>  </p>',
          '            <p>' + vals['description']+ '</p>',
          '            <a href="' + vals['link'] +'" class="btn btn-primary" id="' + r['id'] + '"role="button">See Details</a></p>',
          '        </div>',
          '    </div>',
          '</div>'
        ].join("\n")
    }

    // Initialize client
    var client = new recombee.ApiClient('swissinfo', 'fWgibf2x6w4U606zeTbMfpIsjOOGn4XlbdWUwwLY1pTAV5bonhudtpp9YEOAL6V3');

    // Get it from Google Analytics
    var userId;
    for (var i in window.dataLayer)
    {
        if (window.dataLayer[i][0] == 'config')
        {
            userId = window.dataLayer[i][1];
            break;
        }
    }
    console.log(userId)
    document.getElementById("user").innerHTML = "Items for " + userId;

    // Request recommended items
    client.send(new recombee.RecommendItemsToUser(userId, 9,
      {
        returnProperties: true,
        CascadeCreate: true,
        includedProperties: ['title', 'description', 'link', 'image', 'date', 'tag'],
        scenario: 'homepage'
      }),
      (err, resp) => {
        if(err) {
          console.log("Could not load recomms: ", err);
          return;
        }
        // Show recommendations
        var recomms_html = resp.recomms.map(r => showProduct(r));
        document.getElementById("frontpage_products").innerHTML = recomms_html.join("\n");
        $('.btn').click(function(e) { 
            client.send(new recombee.AddDetailView(userId,$(this).attr('id')));
        });
      }
    );
    </script>
</body>
</html>